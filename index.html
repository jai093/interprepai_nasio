<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Mock Interview Mastery Kit</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; line-height: 1.6; }
        .title-font { font-family: 'Playfair Display', serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .section-divider { background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%); height: 3px; border-radius: 2px; }
        .highlight-box { background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%); border-left: 4px solid #667eea; }
        .question-item { background: #fafbfc; border-left: 3px solid #667eea; transition: all 0.2s ease; }
        .question-item:hover { background: #f0f4ff; transform: translateX(4px); }
    </style>
</head>
<body class="bg-white">
    <div class="gradient-bg text-white min-h-screen flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
            <div class="absolute top-20 left-20 w-32 h-32 border-2 border-white rounded-full"></div>
            <div class="absolute top-40 right-32 w-24 h-24 border-2 border-white rounded-full"></div>
            <div class="absolute bottom-32 left-32 w-40 h-40 border-2 border-white rounded-full"></div>
            <div class="absolute bottom-20 right-20 w-28 h-28 border-2 border-white rounded-full"></div>
        </div>
        <div class="text-center z-10 max-w-4xl mx-auto px-8">
            <div class="mb-8"><i class="fas fa-robot text-6xl mb-6 opacity-90" aria-hidden="true"></i></div>
            <h1 class="title-font text-6xl md:text-7xl font-bold mb-6 leading-tight">AI Mock Interview<br><span class="text-yellow-300">Mastery Kit</span></h1>
            <p class="text-2xl md:text-3xl font-light mb-12 opacity-90">Your Shortcut to Acing Interviews</p>
            <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-8 mb-12"><p class="text-lg leading-relaxed">Tired of practicing interviews alone or not knowing what you're doing wrong? This AI-powered toolkit gives you everything you need to practice smarter, not harder, and land your dream job faster.</p></div>
            <div class="text-xl font-medium">By <span class="text-yellow-300 font-semibold">Sanjay</span></div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-8 py-16">
        <section id="live-practice" class="mb-20">
            <div class="text-center mb-12">
                <h2 class="title-font text-4xl font-bold gradient-text mb-4">Live AI Practice Session</h2>
                <div class="section-divider w-24 mx-auto mb-8"></div>
                <p class="text-lg text-gray-600">Use your voice to answer a question and get instant, spoken feedback.</p>
            </div>
            <div class="bg-gray-50 rounded-2xl p-8 text-center border-2 border-dashed border-gray-300">
                <div class="mb-6 max-w-3xl mx-auto">
                    <label for="question-select" class="block text-lg font-medium text-gray-700 mb-2">1. Choose a question to practice:</label>
                    <select id="question-select" class="w-full p-3 border border-gray-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 text-left"><option value="">-- Select a Question --</option></select>
                </div>
                <div id="ai-status" class="text-lg font-medium text-gray-700 mb-6">Please select a question to begin.</div>
                <button id="start-practice-btn" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform hover:scale-105 transition-transform duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:from-blue-500 disabled:hover:to-purple-600"><i class="fas fa-microphone-alt mr-3"></i>Start Practice</button>
                <div id="practice-area" class="hidden mt-8 text-left">
                    <div class="mb-6"><h4 class="font-bold text-gray-800 text-xl mb-2">Question:</h4><p id="question-display" class="text-gray-700 text-lg p-4 bg-white rounded-lg border"></p></div>
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-gray-800 text-xl">Your Answer (Live Transcription):</h4><div id="timer-container" class="hidden"><span class="text-lg font-medium text-gray-600 bg-gray-200 px-3 py-1 rounded-lg"><i class="far fa-clock mr-2"></i><span id="timer-display">00:00</span></span></div></div>
                        <p id="answer-display" class="text-gray-700 text-lg p-4 bg-white rounded-lg border min-h-[100px]"></p>
                    </div>
                    <div id="report-area" class="hidden">
                        <h4 class="font-bold text-gray-800 text-xl mb-2">Feedback Report:</h4>
                        <div id="report-display" class="p-6 bg-white rounded-lg border border-gray-200 relative"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-20">
            <div class="text-center mb-12"><h2 class="title-font text-4xl font-bold gradient-text mb-4">The Essential Question Bank</h2><div class="section-divider w-24 mx-auto mb-8"></div><p class="text-lg text-gray-600">A curated list of questions to prepare you for anything.</p></div>
            <div class="space-y-8">
                <div><h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><i class="fas fa-sitemap text-blue-500 mr-3"></i>Data Structures & Algorithms</h3><div class="space-y-3" id="dsa-questions"></div></div>
                <div><h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><i class="fas fa-building text-purple-500 mr-3"></i>System Design</h3><div class="space-y-3" id="system-questions"></div></div>
                <div><h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><i class="fas fa-comments text-green-500 mr-3"></i>Behavioural Questions</h3><div class="space-y-3" id="behavioral-questions"></div></div>
                <div><h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><i class="fas fa-cloud text-red-500 mr-3"></i>Modern Tech & Cloud</h3><div class="space-y-3" id="cloud-questions"></div></div>
            </div>
        </section>
        
        <section class="mb-20">
            <div class="text-center mb-12">
                <h2 class="title-font text-4xl font-bold gradient-text mb-4">Industry Pulse: Tech Headlines</h2>
                <div class="section-divider w-24 mx-auto mb-8"></div>
                <p class="text-lg text-gray-600">Stay current with what's happening at top tech companies.</p>
            </div>
            <div id="news-feed-container" class="space-y-4">
                <div class="text-center p-8 text-gray-500"><i class="fas fa-spinner fa-spin text-3xl"></i><p class="mt-2">Loading latest tech news...</p></div>
            </div>
        </section>
    </div>

    <footer class="bg-gray-900 text-white py-12"><div class="max-w-4xl mx-auto px-8 text-center"><div class="mb-6"><i class="fas fa-robot text-4xl text-blue-400 mb-4"></i><h3 class="title-font text-2xl font-bold">AI Mock Interview Mastery Kit</h3></div><p class="text-gray-400 mb-6">Your journey to interview excellence starts now. Practice smarter, not harder.</p><div class="text-sm text-gray-500">Â© 2025 AI Mock Interview Mastery Kit. All rights reserved.</div></div></footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA SETUP ---
        const allQuestions = {
            dsa: ["Reverse a Linked List.", "Find the duplicate number in an array of N+1 integers.", "Merge two sorted Linked Lists.", "Validate if a tree is a Binary Search Tree.", "Find the lowest common ancestor of a Binary Tree.", "Implement a Trie (Prefix Tree).", "Serialize and Deserialize a Binary Tree.", "Find the number of islands in a 2D grid.", "Given a dictionary of words, find if a string can be segmented (Word Break Problem).", "Find the minimum number of coins to make a certain amount (Coin Change)."],
            system: ["How would you design a URL shortener like TinyURL?", "How would you design the backend for Instagram's photo feed?", "How would you design an API rate limiter?", "How would you design a web crawler?", "How would you design a distributed message queue like Kafka or SQS?"],
            behavioral: ["Tell me about your most challenging project.", "Tell me about a time you had to learn something quickly.", "Tell me about a time you disagreed with your manager or a senior.", "Tell me about a mistake you made and what you learned from it.", "Why do you want to work at [Company Name]?", "How do you handle tight deadlines or high-pressure situations?"],
            cloud: ["Explain the difference between a virtual machine and a container.", "How would you set up a basic CI/CD pipeline for a web application?", "What is Infrastructure as Code (IaC) and why is it important?", "Explain the concept of microservices and their trade-offs.", "You have a slow web application. How would you use cloud services to improve performance?"]
        };

        // --- UI ELEMENTS ---
        const questionSelect = document.getElementById('question-select');
        const startBtn = document.getElementById('start-practice-btn');
        const statusEl = document.getElementById('ai-status');
        const practiceArea = document.getElementById('practice-area');
        const questionDisplay = document.getElementById('question-display');
        const answerDisplay = document.getElementById('answer-display');
        const reportArea = document.getElementById('report-area');
        const reportDisplay = document.getElementById('report-display');
        const timerContainer = document.getElementById('timer-container');
        const timerDisplay = document.getElementById('timer-display');
        const newsContainer = document.getElementById('news-feed-container');

        // --- SPEECH & RECOGNITION SETUP ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const synthesis = window.speechSynthesis;
        let recognition;
        let isListening = false;
        let fullTranscript = '';
        let timerInterval;
        let answerDuration = '';

        if (!SpeechRecognition || !synthesis) {
            startBtn.disabled = true;
            startBtn.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Not Supported';
            statusEl.textContent = 'Sorry, your browser does not support the Web Speech API. Please try on Chrome or Edge.';
            return; // Stop further execution if APIs are not supported
        }

        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;

        // --- FUNCTIONS ---
        function populateQuestions() {
            // Populate Question Bank lists
            Object.keys(allQuestions).forEach(key => {
                const container = document.getElementById(`${key}-questions`);
                if(container) {
                    allQuestions[key].forEach(q => {
                        const div = document.createElement('div');
                        div.className = 'question-item p-4 rounded-lg';
                        div.innerHTML = `<p class="font-medium">${q}</p>`;
                        container.appendChild(div);
                    });
                }
            });

            // Populate dropdown select
            Object.values(allQuestions).flat().forEach(q => {
                const option = document.createElement('option');
                option.value = q;
                option.textContent = q;
                questionSelect.appendChild(option);
            });
        }
        
        function speak(text, onEndCallback) {
            if (synthesis.speaking) synthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.onend = () => onEndCallback && onEndCallback();
            synthesis.speak(utterance);
        }

        async function callBackendAPI(type, prompt) {
            // This is the single function to talk to our secure backend
            try {
                const response = await fetch('/api/generate', { // Calls our Vercel function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type, prompt }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `API Error: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Error calling backend for type '${type}':`, error);
                throw error;
            }
        }
        
        async function getAIFeedback(question, answer) {
            statusEl.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>AI is thinking... Please wait.';
            const prompt = `
                You are an expert interview coach for software engineers. Analyze the following interview response.
                Question: "${question}"
                User's Answer: "${answer}"
                Your Task: Return ONLY a valid JSON object with the structure: {"summary": "...", "scores": {"Clarity": <1-10>, "Completeness": <1-10>, "Correctness": <1-10>, "Structure": <1-10>}, "strongPoints": ["..."], "areasToImprove": ["..."], "correctedAnswer": "..."}
            `;
            try {
                const feedback = await callBackendAPI('feedback', prompt);
                feedback.duration = answerDuration;
                displayReport(feedback);
                speak(feedback.summary, () => {
                    statusEl.textContent = 'Practice session complete. Review your report below.';
                    startBtn.disabled = false;
                    startBtn.innerHTML = '<i class="fas fa-redo mr-3"></i>Practice Again';
                });
            } catch (error) {
                statusEl.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i>Error: ${error.message}`;
                startBtn.disabled = false;
                startBtn.innerHTML = '<i class="fas fa-redo mr-3"></i>Practice Again';
            }
        }
        
        function displayReport(feedback) {
            const scoreItems = Object.entries(feedback.scores).map(([key, value]) => `<div><div class="flex justify-between mb-1"><span class="text-base font-medium text-blue-700">${key}</span><span class="text-sm font-medium text-blue-700">${Math.round(value)} / 10</span></div><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: ${Math.round(value) * 10}%"></div></div></div>`).join('');
            reportDisplay.innerHTML = `<button id="copy-feedback-btn" class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg text-sm"><i class="fas fa-copy mr-2"></i>Copy</button><div class="space-y-6"><div><h5 class="font-bold text-xl text-gray-800 mb-4">Performance Scorecard</h5><div class="text-center text-gray-600 mb-4 pb-4 border-b"><i class="far fa-clock mr-2"></i>Duration: <span class="font-bold">${feedback.duration}</span></div><div class="space-y-4">${scoreItems}</div></div><div class="grid md:grid-cols-2 gap-6"><div class="p-4 bg-green-50 rounded-lg border border-green-200"><h5 class="font-bold text-green-700 mb-2"><i class="fas fa-check-circle mr-2"></i>Strong Points</h5><ul class="list-disc list-inside text-green-800 space-y-1 text-sm">${feedback.strongPoints.map(p => `<li>${p}</li>`).join('')}</ul></div><div class="p-4 bg-red-50 rounded-lg border border-red-200"><h5 class="font-bold text-red-700 mb-2"><i class="fas fa-wrench mr-2"></i>Areas for Improvement</h5><ul class="list-disc list-inside text-red-800 space-y-1 text-sm">${feedback.areasToImprove.map(p => `<li>${p}</li>`).join('')}</ul></div></div><div><h5 class="font-bold text-xl text-gray-800 mb-3"><i class="fas fa-star text-yellow-500 mr-2"></i>Model Answer</h5><div class="p-4 bg-gray-100 border border-gray-200 rounded-lg text-gray-700 text-sm"><p>${feedback.correctedAnswer}</p></div></div></div>`;
            reportArea.classList.remove('hidden');
            document.getElementById('copy-feedback-btn').addEventListener('click', () => navigator.clipboard.writeText(JSON.stringify(feedback, null, 2)));
        }

        async function fetchAndRenderNews() {
            const prompt = `You are a tech news editor. Generate a list of 5 recent, realistic, and impactful tech news headlines relevant to a software engineer preparing for interviews. Return ONLY a valid JSON array of objects with the structure: [{"source": "...", "icon": "...", "color": "...", "title": "...", "description": "..."}]`;
            try {
                const articles = await callBackendAPI('news', prompt);
                newsContainer.innerHTML = '';
                if (!articles || articles.length === 0) throw new Error("No articles received.");
                articles.forEach(article => {
                    const newsElement = document.createElement('div');
                    newsElement.className = 'bg-white p-6 rounded-2xl border-2 border-gray-200 flex items-start space-x-4';
                    newsElement.innerHTML = `<div class="flex-shrink-0"><i class="${article.icon} ${article.color} text-3xl"></i></div><div><h3 class="font-bold text-lg text-gray-800">${article.title}</h3><p class="text-gray-600 text-sm mt-1">${article.description}</p><p class="text-xs text-gray-400 font-semibold mt-2 uppercase">${article.source}</p></div>`;
                    newsContainer.appendChild(newsElement);
                });
            } catch (error) {
                newsContainer.innerHTML = `<div class="text-center p-8 text-red-500"><i class="fas fa-exclamation-triangle text-3xl"></i><p class="mt-2">Failed to load news. ${error.message}</p></div>`;
            }
        }
        
        function startListening() {
            fullTranscript = '';
            answerDisplay.textContent = 'Listening...';
            reportArea.classList.add('hidden');
            timerContainer.classList.remove('hidden');
            let startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                timerDisplay.textContent = `${Math.floor(elapsed / 60).toString().padStart(2, '0')}:${(elapsed % 60).toString().padStart(2, '0')}`;
            }, 1000);
            recognition.start();
        }

        // --- EVENT LISTENERS ---
        questionSelect.addEventListener('change', () => {
            startBtn.disabled = !questionSelect.value;
            statusEl.innerHTML = questionSelect.value ? '<strong>2. Press the button to start.</strong>' : 'Please select a question to begin.';
        });

        startBtn.addEventListener('click', () => {
            if (!isListening) {
                startBtn.disabled = true;
                startBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i>Starting...';
                practiceArea.classList.remove('hidden');
                questionDisplay.textContent = questionSelect.value;
                speak(`Let's begin. Your question is: ${questionSelect.value}`, startListening);
            } else {
                clearInterval(timerInterval);
                const elapsed = Math.floor((Date.now() - Date.parse(timerDisplay.dataset.startTime)) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                answerDuration = `${minutes} minute${minutes !== 1 ? 's' : ''} and ${seconds} second${seconds !== 1 ? 's' : ''}`;
                statusEl.textContent = 'Finished listening. Analyzing your answer...';
                recognition.stop();
            }
        });

        recognition.onstart = () => {
            isListening = true;
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-stop-circle mr-3"></i>End Practice';
            timerDisplay.dataset.startTime = new Date();
        };

        recognition.onresult = (event) => {
            let interim = '';
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) fullTranscript += event.results[i][0].transcript + ' ';
                else interim += event.results[i][0].transcript;
            }
            answerDisplay.textContent = fullTranscript + interim;
        };

        recognition.onend = () => {
            isListening = false;
            if (fullTranscript.trim()) {
                getAIFeedback(questionSelect.value, fullTranscript.trim());
            } else {
                statusEl.textContent = 'Did not hear anything. Please try again.';
                startBtn.innerHTML = '<i class="fas fa-redo mr-3"></i>Practice Again';
            }
        };
        
        recognition.onerror = (event) => {
            statusEl.textContent = `Error: ${event.error}. Please check microphone permissions.`;
            isListening = false;
        };
        
        // --- INITIALIZATION ---
        populateQuestions();
        fetchAndRenderNews();
    });
    </script>
</body>
</html>
